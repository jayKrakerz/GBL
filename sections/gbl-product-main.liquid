{% comment %}
  GBL Product Main Section
  - Main product information area
  - Product title, price, variant selector
  - Add to cart functionality
  - Color swatches and size selection
{% endcomment %}

{{ 'component-price.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .gbl-product-main {
    padding: 40px 0;
    background-color: {{ section.settings.background_color }};
  }

  .gbl-product-main__container {
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    gap: 40px;
  }

  .gbl-product-main__images {
    width: 55%;
    position: relative;
  }

  .gbl-product-main__main-image {
    width: 100%;
    margin-bottom: 20px;
  }

  .gbl-product-main__main-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .gbl-product-main__thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }

  .gbl-product-main__thumbnail {
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s ease;
  }

  .gbl-product-main__thumbnail:hover,
  .gbl-product-main__thumbnail--active {
    border-color: {{ section.settings.accent_color }};
  }

  .gbl-product-main__thumbnail img {
    width: 100%;
    height: auto;
    display: block;
  }

  .gbl-product-main__info {
    width: 45%;
    display: flex;
    flex-direction: column;
  }

  .gbl-product-main__breadcrumbs {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    margin-bottom: 15px;
    color: {{ section.settings.text_color }};
  }

  .gbl-product-main__breadcrumb-link {
    color: {{ section.settings.text_color }};
    text-decoration: none;
  }

  .gbl-product-main__breadcrumb-link:hover {
    text-decoration: underline;
  }

  .gbl-product-main__title {
    font-size: 24px;
    font-weight: 500;
    margin-bottom: 15px;
    color: {{ section.settings.title_color }};
    line-height: 1.3;
  }

  .gbl-product-main__price-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }

  .gbl-product-main__price {
    font-size: 24px;
    font-weight: 600;
    color: {{ section.settings.title_color }};
  }

  .gbl-product-main__discount {
    display: inline-block;
    padding: 3px 10px;
    background-color: {{ section.settings.accent_color }};
    color: {{ section.settings.background_color }};
    font-size: 14px;
    font-weight: 600;
    border-radius: 4px;
  }

  .gbl-product-main__ratings {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 20px;
  }

  .gbl-product-main__stars {
    display: flex;
    color: #FFC107;
  }

  .gbl-product-main__reviews-count {
    color: {{ section.settings.text_color }};
    font-size: 14px;
  }

  .gbl-product-main__promo {
    margin-bottom: 20px;
    font-size: 14px;
    color: {{ section.settings.accent_color }};
    font-weight: 500;
  }

  .gbl-product-main__color-options {
    margin-bottom: 20px;
  }

  .gbl-product-main__option-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 10px;
    color: {{ section.settings.title_color }};
  }

  .gbl-product-main__color-swatches {
    display: flex;
    gap: 8px;
  }

  .gbl-product-main__color-swatch {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .gbl-product-main__color-swatch--selected,
  .gbl-product-main__color-swatch:hover {
    border-color: {{ section.settings.accent_color }};
  }

  .gbl-product-main__color-swatch--orange {
    background-color: #e67e22;
  }

  .gbl-product-main__color-swatch--black {
    background-color: #000000;
  }

  .gbl-product-main__size-options {
    margin-bottom: 25px;
  }

  .gbl-product-main__size-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .gbl-product-main__size-button {
    min-width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ddd;
    background-color: transparent;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0 15px;
  }

  .gbl-product-main__size-button:hover,
  .gbl-product-main__size-button--selected {
    border-color: {{ section.settings.accent_color }};
    background-color: {{ section.settings.accent_color }};
    color: #fff;
  }

  .gbl-product-main__actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
  }

  .gbl-product-main__add-to-cart {
    background-color: #000000;
    color: #ffffff;
    border: none;
    padding: 15px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gbl-product-main__add-to-cart:hover {
    background-color: #333;
  }

  .gbl-product-main__wishlist {
    background-color: transparent;
    border: none;
    padding: 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gbl-product-main__wishlist-icon {
    width: 20px;
    height: 20px;
    margin-right: 10px;
  }

  .gbl-product-main__accordion {
    border-top: 1px solid #eee;
  }

  .gbl-product-main__accordion-item {
    border-bottom: 1px solid #eee;
  }

  .gbl-product-main__accordion-header {
    padding: 15px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }

  .gbl-product-main__accordion-title {
    font-size: 16px;
    font-weight: 500;
    color: {{ section.settings.title_color }};
  }

  .gbl-product-main__accordion-icon {
    width: 16px;
    height: 16px;
    transition: transform 0.3s ease;
  }

  .gbl-product-main__accordion-icon--open {
    transform: rotate(180deg);
  }

  .gbl-product-main__accordion-content {
    padding: 0 0 15px;
    font-size: 14px;
    line-height: 1.5;
    color: {{ section.settings.text_color }};
    display: none;
  }

  .gbl-product-main__accordion-content--open {
    display: block;
  }

  .gbl-product-main__accordion-content p {
    margin: 0 0 10px 0;
  }

  .gbl-product-main__accordion-content ul {
    margin: 0 0 10px 0;
    padding-left: 20px;
  }

  @media screen and (max-width: 990px) {
    .gbl-product-main__container {
      flex-direction: column;
    }
    
    .gbl-product-main__images,
    .gbl-product-main__info {
      width: 100%;
    }
  }

  @media screen and (max-width: 580px) {
    .gbl-product-main {
      padding: 20px 0;
    }
    
    .gbl-product-main__title {
      font-size: 20px;
    }
    
    .gbl-product-main__price {
      font-size: 20px;
    }
    
    .gbl-product-main__thumbnails {
      grid-template-columns: repeat(3, 1fr);
    }
  }
{%- endstyle -%}

<section class="gbl-product-main">
  <div class="gbl-product-main__container">
    <div class="gbl-product-main__images">
      <div class="gbl-product-main__main-image">
        {{ product.featured_image | image_url: width: 800 | image_tag: loading: 'eager', alt: product.title, id: 'FeaturedImage' }}
      </div>
      
      <div class="gbl-product-main__thumbnails">
        {% for image in product.images %}
          <div class="gbl-product-main__thumbnail{% if forloop.first %} gbl-product-main__thumbnail--active{% endif %}" data-src="{{ image | image_url: width: 800 }}">
            {{ image | image_url: width: 150 | image_tag: alt: product.title, loading: 'lazy' }}
          </div>
        {% endfor %}
      </div>
    </div>
    
    <div class="gbl-product-main__info">
      <div class="gbl-product-main__breadcrumbs">
        <a href="{{ routes.root_url }}" class="gbl-product-main__breadcrumb-link">Shop</a>
        <span>&gt;</span>
        <a href="{{ product.collection.url }}" class="gbl-product-main__breadcrumb-link">{{ product.collection.title }}</a>
        <span>&gt;</span>
        <span>{{ product.title }}</span>
      </div>
      
      <h1 class="gbl-product-main__title">{{ product.title }}</h1>
      
      <div class="gbl-product-main__price-container">
        <span class="gbl-product-main__price">{{ product.price | money }}</span>
        {% if product.compare_at_price > product.price %}
          {% assign discount_amount = product.compare_at_price | minus: product.price %}
          {% assign discount_percentage = discount_amount | times: 100 | divided_by: product.compare_at_price %}
          <span class="gbl-product-main__discount">${{ discount_amount | money_without_currency }} OFF</span>
        {% endif %}
      </div>
      
      {% if product.metafields.reviews.rating %}
        <div class="gbl-product-main__ratings">
          <div class="gbl-product-main__stars">
            {% assign rating = product.metafields.reviews.rating.value | round: 1 %}
            {% if rating >= 5 %}
              ★★★★★
            {% elsif rating >= 4.5 %}
              ★★★★½
            {% elsif rating >= 4 %}
              ★★★★☆
            {% elsif rating >= 3.5 %}
              ★★★½☆
            {% elsif rating >= 3 %}
              ★★★☆☆
            {% elsif rating >= 2.5 %}
              ★★½☆☆
            {% elsif rating >= 2 %}
              ★★☆☆☆
            {% elsif rating >= 1.5 %}
              ★½☆☆☆
            {% elsif rating >= 1 %}
              ★☆☆☆☆
            {% else %}
              ☆☆☆☆☆
            {% endif %}
          </div>
          
          <span class="gbl-product-main__reviews-count">
            {{ product.metafields.reviews.rating_count }}
          </span>
        </div>
      {% endif %}
      
      {% if section.settings.show_promo_message %}
        <div class="gbl-product-main__promo">
          {{ section.settings.promo_message }}
        </div>
      {% endif %}
      
      <form method="post" action="/cart/add" id="product-form-{{ product.id }}">
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        
        {% for option in product.options_with_values %}
          <div class="gbl-product-main__{{ option.name | handleize }}-options">
            <div class="gbl-product-main__option-title">{{ option.name }}</div>
            
            {% if option.name == 'Color' or option.name contains 'color' or option.name contains 'Colour' %}
              <div class="gbl-product-main__color-swatches">
                {% for value in option.values %}
                  <div class="gbl-product-main__color-swatch gbl-product-main__color-swatch--{{ value | handleize }}{% if forloop.first %} gbl-product-main__color-swatch--selected{% endif %}" 
                       data-option-value="{{ value | escape }}"
                       title="{{ value }}"></div>
                {% endfor %}
              </div>
            {% elsif option.name == 'Size' or option.name contains 'size' %}
              <div class="gbl-product-main__size-buttons">
                {% for value in option.values %}
                  <button type="button" class="gbl-product-main__size-button{% if forloop.first %} gbl-product-main__size-button--selected{% endif %}" 
                          data-option-value="{{ value | escape }}">
                    {{ value }}
                  </button>
                {% endfor %}
              </div>
            {% else %}
              <select name="options[{{ option.name | escape }}]" class="gbl-product-main__option-select">
                {% for value in option.values %}
                  <option value="{{ value | escape }}" {% if forloop.first %}selected="selected"{% endif %}>{{ value }}</option>
                {% endfor %}
              </select>
            {% endif %}
          </div>
        {% endfor %}
        
        <div class="gbl-product-main__actions">
          <button type="submit" class="gbl-product-main__add-to-cart">
            Add to Bag
          </button>
          
          {% if section.settings.show_wishlist_button %}
            <button type="button" class="gbl-product-main__wishlist">
              <svg class="gbl-product-main__wishlist-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke="currentColor" stroke-width="1.5" fill="none"/>
              </svg>
              Add to Wishlist
            </button>
          {% endif %}
        </div>
      </form>
      
      <div class="gbl-product-main__accordion">
        <div class="gbl-product-main__accordion-item">
          <div class="gbl-product-main__accordion-header" data-target="product-details">
            <span class="gbl-product-main__accordion-title">Product Details</span>
            <svg class="gbl-product-main__accordion-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="gbl-product-main__accordion-content" id="product-details">
            <div class="product-description">
              {{ product.description }}
            </div>
          </div>
        </div>
        
        <div class="gbl-product-main__accordion-item">
          <div class="gbl-product-main__accordion-header" data-target="return-policy">
            <span class="gbl-product-main__accordion-title">7 Days Return</span>
            <svg class="gbl-product-main__accordion-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="gbl-product-main__accordion-content" id="return-policy">
            <p>Our products come with a 7-day return policy. If you're not satisfied with your purchase, you can return it within 7 days for a full refund or exchange.</p>
            <p>Please note:</p>
            <ul>
              <li>Items must be unused and in original packaging</li>
              <li>Return shipping costs are the responsibility of the customer</li>
              <li>Sale items are final sale and cannot be returned</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Thumbnail gallery
    const thumbnails = document.querySelectorAll('.gbl-product-main__thumbnail');
    const featuredImage = document.getElementById('FeaturedImage');
    
    thumbnails.forEach(function(thumbnail) {
      thumbnail.addEventListener('click', function() {
        // Update active state
        thumbnails.forEach(t => t.classList.remove('gbl-product-main__thumbnail--active'));
        this.classList.add('gbl-product-main__thumbnail--active');
        
        // Update main image
        const newSrc = this.getAttribute('data-src');
        featuredImage.setAttribute('src', newSrc);
      });
    });
    
    // Color swatches
    const colorSwatches = document.querySelectorAll('.gbl-product-main__color-swatch');
    colorSwatches.forEach(function(swatch) {
      swatch.addEventListener('click', function() {
        colorSwatches.forEach(s => s.classList.remove('gbl-product-main__color-swatch--selected'));
        this.classList.add('gbl-product-main__color-swatch--selected');
      });
    });
    
    // Size buttons
    const sizeButtons = document.querySelectorAll('.gbl-product-main__size-button');
    sizeButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        sizeButtons.forEach(b => b.classList.remove('gbl-product-main__size-button--selected'));
        this.classList.add('gbl-product-main__size-button--selected');
      });
    });
    
    // Accordion
    const accordionHeaders = document.querySelectorAll('.gbl-product-main__accordion-header');
    accordionHeaders.forEach(function(header) {
      header.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const content = document.getElementById(targetId);
        const icon = this.querySelector('.gbl-product-main__accordion-icon');
        
        // Toggle content
        if (content.classList.contains('gbl-product-main__accordion-content--open')) {
          content.classList.remove('gbl-product-main__accordion-content--open');
          icon.classList.remove('gbl-product-main__accordion-icon--open');
        } else {
          content.classList.add('gbl-product-main__accordion-content--open');
          icon.classList.add('gbl-product-main__accordion-icon--open');
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product Main",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_promo_message",
      "label": "Show Promotion Message",
      "default": true
    },
    {
      "type": "text",
      "id": "promo_message",
      "label": "Promotion Message",
      "default": "25% OFF EVERYTHING! Use Code: KIRTT24"
    },
    {
      "type": "checkbox",
      "id": "show_wishlist_button",
      "label": "Show Wishlist Button",
      "default": true
    },
    {
      "type": "header",
      "content": "Style settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color",
      "default": "#d4af37"
    }
  ],
  "presets": [
    {
      "name": "GBL Product Main"
    }
  ]
}
{% endschema %}